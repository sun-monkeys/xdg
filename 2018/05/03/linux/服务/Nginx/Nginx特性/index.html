<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.css.network/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Consolas:300,300italic,400,400italic,700,700italic|Iosevka:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Nginx," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.0" />






<meta name="description" content="ngx_http_core_module与套接字相关的配置server123456server &amp;#123; ... &amp;#125;  # 配置一个虚拟主机   server &amp;#123;      listen address[:PORT]|PORT;      server_name SERVER_NAME;      root /PATH/TO/DOCUMENT_ROOT;   &amp;#125;">
<meta name="keywords" content="Nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx特性">
<meta property="og:url" content="http://yoursite.com/2018/05/03/linux/服务/Nginx/Nginx特性/index.html">
<meta property="og:site_name" content="Zookeeper">
<meta property="og:description" content="ngx_http_core_module与套接字相关的配置server123456server &amp;#123; ... &amp;#125;  # 配置一个虚拟主机   server &amp;#123;      listen address[:PORT]|PORT;      server_name SERVER_NAME;      root /PATH/TO/DOCUMENT_ROOT;   &amp;#125;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-08-08T09:55:53.584Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nginx特性">
<meta name="twitter:description" content="ngx_http_core_module与套接字相关的配置server123456server &amp;#123; ... &amp;#125;  # 配置一个虚拟主机   server &amp;#123;      listen address[:PORT]|PORT;      server_name SERVER_NAME;      root /PATH/TO/DOCUMENT_ROOT;   &amp;#125;">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/05/03/linux/服务/Nginx/Nginx特性/"/>





  <title> Nginx特性 | Zookeeper </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?822bf9a08ff5afbcfcc481a56a6ad577";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zookeeper</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Still see you as the whole of my life</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home Page
          </a>
        </li>
      
        
        <li class="menu-item menu-item-linux1">
          <a href="/categories/LinuxBasics" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-linux"></i> <br />
            
            Linux Basics
          </a>
        </li>
      
        
        <li class="menu-item menu-item-linux2">
          <a href="/categories/LinuxServices" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-linux"></i> <br />
            
            Linux Services
          </a>
        </li>
      
        
        <li class="menu-item menu-item-python1">
          <a href="/categories/PythonBasics" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-rub"></i> <br />
            
            Python Basics
          </a>
        </li>
      
        
        <li class="menu-item menu-item-python2">
          <a href="/categories/PythonCase" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-rub"></i> <br />
            
            Python Case
          </a>
        </li>
      
        
        <li class="menu-item menu-item-question1">
          <a href="/categories/CommonQuestion" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-bug"></i> <br />
            
            Common Question
          </a>
        </li>
      
        
        <li class="menu-item menu-item-question2">
          <a href="/categories/InterviewQuestion" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-bug"></i> <br />
            
            Interview Question
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/03/linux/服务/Nginx/Nginx特性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XDG">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zookeeper">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Nginx特性
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-03T00:00:10+08:00">
                2018-05-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LinuxServices/" itemprop="url" rel="index">
                    <span itemprop="name">LinuxServices</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="ngx-http-core-module"><a href="#ngx-http-core-module" class="headerlink" title="ngx_http_core_module"></a>ngx_http_core_module</h1><h2 id="与套接字相关的配置"><a href="#与套接字相关的配置" class="headerlink" title="与套接字相关的配置"></a>与套接字相关的配置</h2><h3 id="server"><a href="#server" class="headerlink" title="server"></a>server</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123; <span class="built_in">..</span>. &#125;  # 配置一个虚拟主机</span><br><span class="line">  <span class="built_in"> server </span>&#123;</span><br><span class="line">      listen address[:PORT]|PORT;</span><br><span class="line">      server_name SERVER_NAME;</span><br><span class="line">      root /PATH/<span class="keyword">TO</span>/DOCUMENT_ROOT;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">listen PORT|address[:port]|unix:/PATH/<span class="keyword">TO</span>/SOCKET_FILE</span><br><span class="line">listen address[:port] [default_server] [ssl] [http2|spdy] </span><br><span class="line">  [<span class="attribute">backlog</span>=number] [<span class="attribute">rcvbuf</span>=size] [<span class="attribute">sndbuf</span>=size]</span><br><span class="line"></span><br><span class="line">default_server  # 设定为默认虚拟主机</span><br><span class="line">ssl  # 限制仅能够通过ssl连接提供服务</span><br><span class="line"><span class="attribute">backlog</span>=number  # 超过并发连接数后，新请求进入后援队列的长度</span><br><span class="line"><span class="attribute">rcvbuf</span>=size  # 接收缓冲区大小</span><br><span class="line"><span class="attribute">sndbuf</span>=size  # 发送缓冲区大小</span><br><span class="line"></span><br><span class="line">(1) 基于port</span><br><span class="line">   listen<span class="built_in"> PORT; </span> # 指令监听在不同的端口</span><br><span class="line">(2) 基于ip的虚拟主机</span><br><span class="line">   listen IP:PORT;  #<span class="built_in"> IP </span>地址不同</span><br><span class="line">(3) 基于hostname</span><br><span class="line">   server_name fqdn;  # 指令指向不同的主机名</span><br></pre></td></tr></table></figure>
<h3 id="server-name"><a href="#server-name" class="headerlink" title="server_name"></a>server_name</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server_name name <span class="string">...</span>;</span><br><span class="line">虚拟主机的主机名称后可跟多个由空白字符分隔的字符串</span><br><span class="line"></span><br><span class="line">支持*通配任意长度的任意字符</span><br><span class="line">   server_name   *<span class="string">.xdg.com</span>  www.xdg.* ;</span><br><span class="line">   <span class="comment"># 空间用空格隔开</span></span><br><span class="line"></span><br><span class="line">支持~起始的字符做正则表达式模式匹配，性能原因慎用</span><br><span class="line">   server_name ~^www\d+\<span class="string">.xdg</span>\<span class="string">.com</span>$</span><br><span class="line">   \d 表示 [0-9]</span><br><span class="line"></span><br><span class="line">匹配优先级机制从高到低</span><br><span class="line">   <span class="params">(1)</span> 首先是字符串精确匹配 如: www.xdg.com</span><br><span class="line">   <span class="params">(2)</span> 左侧*通配符 如: *<span class="string">.xdg.com</span></span><br><span class="line">   <span class="params">(3)</span> 右侧*通配符 如: www.xdg.*</span><br><span class="line">   <span class="params">(4)</span> 正则表达式 如: ~^.*\<span class="string">.xdg</span>\<span class="string">.com</span>$</span><br><span class="line">   <span class="params">(5)</span> default_server</span><br></pre></td></tr></table></figure>
<h3 id="tcp-nodelay"><a href="#tcp-nodelay" class="headerlink" title="tcp_nodelay"></a>tcp_nodelay</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tcp_nodelay <span class="keyword">on</span> | <span class="keyword">off</span>;</span><br><span class="line">在keepalived模式下的连接是否启用TCP_NODELAY选项</span><br><span class="line">   当为<span class="keyword">off</span>时，延迟发送，合并多个请求后再发送</span><br><span class="line">   默认<span class="keyword">On</span>时，不延迟发送</span><br><span class="line">可用于: http, server, location</span><br></pre></td></tr></table></figure>
<h3 id="sendfile"><a href="#sendfile" class="headerlink" title="sendfile"></a>sendfile</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sendfile <span class="keyword">on</span> | off;</span><br><span class="line">是否启用sendfile功能，在内核中封装报文直接发送</span><br></pre></td></tr></table></figure>
<h3 id="server-tokens"><a href="#server-tokens" class="headerlink" title="server_tokens"></a>server_tokens</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server_tokens on | off | build | string</span><br><span class="line">是否在响应报文的Server首部显示nginx版本</span><br><span class="line"><span class="meta">#</span><span class="bash"> server_tokens off  <span class="comment"># curl -I ip，查看的时候，只显示nginx，具体的版本信息是没有的</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> build 和 string这两个选项在一些版本当中是不支持的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 字段在http中</span></span><br></pre></td></tr></table></figure>
<h2 id="定义路径相关的配置"><a href="#定义路径相关的配置" class="headerlink" title="定义路径相关的配置"></a>定义路径相关的配置</h2><h3 id="root"><a href="#root" class="headerlink" title="root"></a>root</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">设置web资源的路径映射；用于指明请求的URL所对应的文档的目录路径，可用于http, server,location, <span class="keyword">if</span> <span class="keyword">in</span> location</span><br><span class="line">server &#123;</span><br><span class="line">   ...</span><br><span class="line">   root  /data/www/vhost1;</span><br><span class="line">&#125;</span><br><span class="line">例<span class="symbol">:</span></span><br><span class="line">   <span class="symbol">http:</span>/<span class="regexp">/ip/images</span><span class="regexp">/logo.jpg --&gt; /data</span><span class="regexp">/www/vhosts</span><span class="regexp">/images/logo</span>.jpg</span><br></pre></td></tr></table></figure>
<h3 id="location"><a href="#location" class="headerlink" title="location"></a>location</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">[ = | ~ | ~* | ^~ ] uri</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">@name</span> &#123; ... &#125;</span><br><span class="line">在一个server中location配置段可存在多个，用于实现从uri到文件系统的路径映射，ngnix会根据用户请求的URI来检查定义所有的location，并找出一个最佳匹配，应用其配置</span><br><span class="line">例:</span><br><span class="line">   server &#123;</span><br><span class="line">      ...</span><br><span class="line">      server_name www.a.com;</span><br><span class="line">      root  /app/website;</span><br><span class="line">      <span class="keyword">location</span> <span class="title">/images</span>/ &#123;</span><br><span class="line">         root  /data/imgs/;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">curl www.a.com  <span class="comment"># 访问/app/website/index.html这个页面</span></span><br><span class="line">curl www.a.com/images/  <span class="comment"># 访问/data/imge/index.html这个页面（后面的/必须要加上）</span></span><br><span class="line"><span class="comment"># 上面的root跟下面的root两者相互不影响</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">location</span> <span class="title">/images</span>/ &#123; ... &#125; images后面的/（斜杠）的区别</span><br><span class="line">   如果加上:</span><br><span class="line">      curl www.a.com/images/  <span class="comment"># 这样访问是正确的</span></span><br><span class="line">      curl www.a.com/images  <span class="comment"># 这样访问提示是404信息</span></span><br><span class="line">   如果没加上:</span><br><span class="line">      curl www.a.com/images/   <span class="comment"># 这样访问是正确的</span></span><br><span class="line">      curl www.a.com/images  <span class="comment"># 这样访问提示是301信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在root /data/imgs/; 最后的 / 加没有加是没有影响的，而在浏览器当中会自动帮你加上 / 不会出现这种问题</span></span><br><span class="line"></span><br><span class="line">=: 对URI做精确匹配</span><br><span class="line">   <span class="keyword">location</span> <span class="title">= / &#123;</span></span><br><span class="line"><span class="title">      ...</span></span><br><span class="line"><span class="title">   &#125;</span></span><br><span class="line"><span class="title">http</span>://www.a.com/  <span class="comment"># 匹配</span></span><br><span class="line">http://www.a/index.html  <span class="comment"># 不匹配</span></span><br><span class="line"></span><br><span class="line">^~  <span class="comment"># 对URI的最左边部分做匹配检查，不区分字符大小写</span></span><br><span class="line">~  <span class="comment"># 对URI做正则表达式模式匹配，区分字符大小写</span></span><br><span class="line">~*  <span class="comment"># 对URI做正则表达式模式匹配，不区分字符大小写</span></span><br><span class="line">不带符号: 匹配起始于此uri的所有的uri</span><br><span class="line">匹配优先级从高到低: =, ^~, ～/～*, 不带符号（/:不带符号）</span><br><span class="line"></span><br><span class="line">例:</span><br><span class="line">   root /vhosts/www/htdocs/</span><br><span class="line">   <span class="comment"># http://www.a.com/index.html --&gt; /vhosts/www/htdocs/index.html</span></span><br><span class="line"></span><br><span class="line">   server &#123;</span><br><span class="line">      root  /vhosts/www/htdocs/</span><br><span class="line">      <span class="keyword">location</span> <span class="title">/admin</span>/ &#123;</span><br><span class="line">         root /webapps/app1/data/;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment"># http://www.a.com/admin/index.html --&gt; /webapps/app1/data/admin/index.html</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">location</span> <span class="title">=  / &#123; [ configuration</span> A ] &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">location</span> <span class="title">/  &#123; [ configuration</span> B ] &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">location</span> <span class="title">/documents</span>/ &#123; [ configuration C ] &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">location</span> <span class="title">^~  /images</span>/ &#123; [ configuration D ] &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">location</span> <span class="title">~*  \.(gif</span>|jpg|jpeg)$ &#123; [ configuration E ] &#125;</span><br><span class="line"></span><br><span class="line">结果:</span><br><span class="line">   The <span class="string">"/"</span> request will match configuration A,</span><br><span class="line">   the <span class="string">"/index.html"</span> request will match configuration B,</span><br><span class="line">   the <span class="string">"/documents/document.html"</span> request will match configuration C,</span><br><span class="line">   the <span class="string">"/images/1.gif"</span> request will match configuration D, <span class="keyword">and</span></span><br><span class="line">   the <span class="string">"/documents/1.jpg"</span> request will match configuration E.</span><br></pre></td></tr></table></figure>
<h3 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alias</span> path;  <span class="comment"># 路径别名，文档映射的另一种机制，仅能用于location上下文</span></span><br><span class="line">例:</span><br><span class="line">访问的地址: curl http:<span class="string">//ip/bbs/index.html</span></span><br><span class="line">   location <span class="string">/bbs/</span> &#123;</span><br><span class="line">      <span class="keyword">alias</span> <span class="string">/web/forum/</span>;</span><br><span class="line">   &#125;</span><br><span class="line">--&gt; <span class="string">/web/forum/index.html</span>  <span class="comment"># 访问的时间，就是访问这个目录</span></span><br><span class="line"></span><br><span class="line">   location <span class="string">/bbs/</span> &#123;</span><br><span class="line">      root <span class="string">/web/forum/</span>;</span><br><span class="line">   &#125;</span><br><span class="line">--&gt; <span class="string">/web/forum/bbs/index.html</span>  <span class="comment"># 访问的时候，访问的是/bbs/目录下的</span></span><br><span class="line"></span><br><span class="line">location中使用root指令和<span class="keyword">alias</span>指令的意义不同</span><br><span class="line">   <span class="params">(a)</span> root，给定的路径对应于location中的<span class="string">/uri/</span>左侧的/</span><br><span class="line">   <span class="params">(b)</span> <span class="keyword">alias</span>，给定的路径对应于location中的<span class="string">/uri/</span>右侧的/</span><br></pre></td></tr></table></figure>
<h3 id="index"><a href="#index" class="headerlink" title="index"></a>index</h3><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span> <span class="keyword">file</span> ...;</span><br><span class="line">   指定默认网页资源 <span class="keyword">index</span> <span class="keyword">index</span>.html <span class="keyword">index</span>.htm</span><br><span class="line">   ngx_http_index_module模块</span><br></pre></td></tr></table></figure>
<h3 id="error-page"><a href="#error-page" class="headerlink" title="error_page"></a>error_page</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">error_page code ... [=[response]] uri;</span><br><span class="line">ngx_http_core_module模块</span><br><span class="line"></span><br><span class="line">定义错误页，以指定的响应状态码进行响应</span><br><span class="line">可用位置: http, server, location, if <span class="keyword">in</span> location</span><br><span class="line"></span><br><span class="line">error_page <span class="number">404</span>  /<span class="number">404</span>.html</span><br><span class="line">   错误代码<span class="number">404</span>的时候，跳转到<span class="number">404</span>.html这个页面（在root的指定目录下）</span><br><span class="line"></span><br><span class="line">error_page <span class="number">404</span>  =<span class="number">200</span>  /<span class="number">404</span>.html</span><br><span class="line">   就算是错误的代码，返回的时候也是返回正确的<span class="number">200</span>代码，再显示<span class="number">404</span>.html这个页面信息，有的浏览器，会检测到错误的信息的时候，会劫持到自己的所错误的页面，从而打广告</span><br><span class="line"></span><br><span class="line"><span class="keyword">location</span> <span class="title">/404</span>.html &#123;</span><br><span class="line">   alias /app/error_page/;  <span class="comment"># 错误的页面可以指定到某一个目录下面</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="try-files"><a href="#try-files" class="headerlink" title="try_files"></a>try_files</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>_files file <span class="string">...</span> uri;</span><br><span class="line"><span class="keyword">try</span>_files file <span class="string">...</span> =code;</span><br><span class="line"></span><br><span class="line">按顺序检查文件是否存在，返回第一个找到的文件或文件夹（结尾加斜线表示为文件夹），如果所有的文件或文件夹都找不到，会进行一个内部重定向到最后一个参数，</span><br><span class="line">  只有最后一个参数可以引起一个内部重定向，之前的参数只设置内部URI的指向，最后一个参数是回退URI且必须存在，否则会出现内部500错误</span><br><span class="line"></span><br><span class="line">location <span class="string">/images/</span> &#123;</span><br><span class="line">   <span class="keyword">try</span>_files $uri <span class="string">/images/default.gif</span>;</span><br><span class="line">&#125;</span><br><span class="line">例: curl  http:<span class="string">//ip/images/a.jpg</span></span><br><span class="line"><span class="comment"># $uri 指的是images目录下的uri的所指定的文件</span></span><br><span class="line"><span class="comment"># 按顺序查找，如果没有找到uri所指定的文件，则使用default.gif，如果也没有，出现500错误</span></span><br><span class="line"><span class="comment"># 只要是在这个目录下（images）所访问不到的都会指向default.gif这个文件</span></span><br><span class="line"></span><br><span class="line">curl http:<span class="string">//ip/images/aa/bb/cc/dd.txt</span>  <span class="comment"># 如果这个文件没有，会跳转到default.gif文件</span></span><br><span class="line">curl http:<span class="string">//ip/immm/a.jpg</span>  <span class="comment"># 这个目录下是没有办法进行跳转的（不在同一目录）</span></span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">   <span class="keyword">try</span>_files $uri $uri/index.html $uri.html =404;</span><br><span class="line">   <span class="comment"># 虽然有返回数据，但是还是错误的，返回错误信息404</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">例:</span><br><span class="line">   root <span class="string">/app/website</span></span><br><span class="line">   error_page 404 <span class="string">/404.html</span></span><br><span class="line">   location <span class="string">/images</span> &#123;</span><br><span class="line">      <span class="keyword">try</span>_files  $uri <span class="string">/images/a.txt</span>  =404;  <span class="comment"># 如果这个也没有，转到404页面</span></span><br><span class="line">   &#125;</span><br><span class="line">   location <span class="string">/404.html</span> &#123;</span><br><span class="line">      <span class="keyword">alias</span>  <span class="string">/app/wesite/error_page/404.html</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">当用户访问images目录下的a.txt和b.txt文件时，正常！如果都没有的话，返回错误信息，但是在上面定义了错误信息页面，会跳转到下面定义的location里所指定的错误页面404.html</span><br><span class="line"></span><br><span class="line">当用户访问的时候 curl http:<span class="string">//ip/images/xx.txt</span></span><br><span class="line">  images目录下有没有xx.txt这个文件，找下一个a.txt这个文件，如果没有a.txt文件的话，则返回404错误信息</span><br></pre></td></tr></table></figure>
<h2 id="定义客户端请求的相关配置"><a href="#定义客户端请求的相关配置" class="headerlink" title="定义客户端请求的相关配置"></a>定义客户端请求的相关配置</h2><h3 id="keepalive-timeout"><a href="#keepalive-timeout" class="headerlink" title="keepalive_timeout"></a>keepalive_timeout</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keepalive_timeout timeout [header_timeout];</span><br><span class="line">设定保持连接超时时长，<span class="number">0</span>表示禁止长连接</span><br><span class="line">默认为<span class="number">75</span>s</span><br></pre></td></tr></table></figure>
<h3 id="keepalive-requests"><a href="#keepalive-requests" class="headerlink" title="keepalive_requests"></a>keepalive_requests</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keepalive_requests number<span class="comment">;</span></span><br><span class="line">在一次长连接上所允许请求的资源的最大数量</span><br><span class="line">默认为<span class="number">100</span></span><br></pre></td></tr></table></figure>
<h3 id="keepalive-disable"><a href="#keepalive-disable" class="headerlink" title="keepalive_disable"></a>keepalive_disable</h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keepalive_disable <span class="literal">none</span> | browser <span class="params">...</span></span><br><span class="line">对哪种浏览器禁用长连接</span><br></pre></td></tr></table></figure>
<h3 id="send-timeout"><a href="#send-timeout" class="headerlink" title="send_timeout"></a>send_timeout</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">send_timeout time<span class="comment">;</span></span><br><span class="line">向客户端发送响应报文的超时时长，此处是指两次写操作之间的间隔时长，而非整个响应过程的传输时长</span><br></pre></td></tr></table></figure>
<h3 id="client-body-buffer-size"><a href="#client-body-buffer-size" class="headerlink" title="client_body_buffer_size"></a>client_body_buffer_size</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client_body_buffer_size  size<span class="comment">;</span></span><br><span class="line">用于接收每个客户端请求报文的<span class="keyword">body部分的缓冲区大小</span></span><br><span class="line"><span class="keyword">默认为16k，超出此大小时，其将被暂存到磁盘上的由client_body_temp_path指令所定义的位置</span></span><br></pre></td></tr></table></figure>
<h3 id="client-body-temp-path"><a href="#client-body-temp-path" class="headerlink" title="client_body_temp_path"></a>client_body_temp_path</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">client_body_temp_path  path [level1 [level2 [level3]]];</span><br><span class="line">设定用于存储客户端请求报文的body部分的临时存储路径及子目录结构和数量</span><br><span class="line">目录名为<span class="number">16</span>进制的数字</span><br><span class="line">client_body_temp_path  /var/tmp/client_body  <span class="number">1</span> <span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span> <span class="number">1</span>级目录占<span class="number">1</span>位<span class="number">16</span>进制，即<span class="number">2</span>^<span class="number">4</span>=<span class="number">16</span>个目录 <span class="number">0</span>-f</span><br><span class="line"><span class="number">2</span> <span class="number">2</span>级目录占<span class="number">2</span>位<span class="number">16</span>进制，即<span class="number">2</span>^<span class="number">8</span>=<span class="number">256</span>个目录 <span class="number">00</span>-ff</span><br><span class="line"><span class="number">2</span> <span class="number">3</span>级目录占<span class="number">2</span>位<span class="number">16</span>进制，即<span class="number">2</span>^<span class="number">8</span>=<span class="number">256</span>个目录 <span class="number">00</span>-ff</span><br></pre></td></tr></table></figure>
<h3 id="limit-rate"><a href="#limit-rate" class="headerlink" title="limit_rate"></a>limit_rate</h3><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">limit_rate <span class="built_in">rate</span>;</span><br><span class="line">限制响应给客户端的传输速率，单位是bytes/<span class="built_in">second</span></span><br><span class="line">默认值<span class="number">0</span>表示无限制</span><br></pre></td></tr></table></figure>
<h3 id="limit-except"><a href="#limit-except" class="headerlink" title="limit_except"></a>limit_except</h3><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">limit_except <span class="function"><span class="keyword">method</span> ... <span class="comment">&#123; ... &#125;</span></span></span><br><span class="line"><span class="function">仅用于 <span class="title">location</span> 限制客户端使用除了指定的请求方法之外的其它方法</span></span><br><span class="line"><span class="function"><span class="title">method</span>:</span> GET, HEAD, POST, PUT, DELETE MKCOL, <span class="keyword">COPY</span>, MOVE, OPTIONS, PROPFIND, PROPPATCH, LOCK, UNLOCK, PATCH</span><br><span class="line"></span><br><span class="line">limit_except GET <span class="comment">&#123;</span></span><br><span class="line"><span class="comment">   allow 192.168.1.0/24;</span></span><br><span class="line"><span class="comment">   deny  all;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"># 除了 GET 和 HEAD 之外其它方法仅允许<span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span>网段主机使用</span><br></pre></td></tr></table></figure>
<h2 id="文件操作优化的配置"><a href="#文件操作优化的配置" class="headerlink" title="文件操作优化的配置"></a>文件操作优化的配置</h2><h3 id="aio"><a href="#aio" class="headerlink" title="aio"></a>aio</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aio <span class="keyword">on</span> | off | threads[=pool];</span><br><span class="line">是否启用aio功能  <span class="comment"># 异步IO</span></span><br></pre></td></tr></table></figure>
<h3 id="directio"><a href="#directio" class="headerlink" title="directio"></a>directio</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">directio size | <span class="keyword">off</span>;  <span class="comment"># 同步IO</span></span><br><span class="line">是否同步（直接）写磁盘，而非写缓存，在Linux主机启用 O_DIRECT标记，则文件大于等于给定大小时使用，如: directio <span class="number">4</span>m</span><br></pre></td></tr></table></figure>
<h3 id="open-file-cache"><a href="#open-file-cache" class="headerlink" title="open_file_cache"></a>open_file_cache</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">open_file_cache off;</span><br><span class="line">open_file_cache <span class="attribute">max</span>=N [<span class="attribute">inactive</span>=time];</span><br><span class="line"></span><br><span class="line">nginx可以缓存以下三种信息:</span><br><span class="line">   (1) 文件元数据: 文件的描述符、文件大小和最近一次的修改时间</span><br><span class="line">   (2) 打开的目录结构</span><br><span class="line">   (3) 没有找到的或者没有权限访问的文件的相关信息</span><br><span class="line">      <span class="attribute">max</span>=N: 可缓存的缓存项上限，达到上限后会使用LRU算法实现管理</span><br><span class="line">      <span class="attribute">inactive</span>=time: 缓存项的非活动时长，在此处指定的时长内未被命中的或命中的次数少于open_file_cache_min_uses指令所指定的次数的缓存项即为非活动项，将被删除</span><br></pre></td></tr></table></figure>
<h3 id="open-file-cache-errors"><a href="#open-file-cache-errors" class="headerlink" title="open_file_cache_errors"></a>open_file_cache_errors</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">open_file_cache_errors <span class="keyword">on</span> | <span class="keyword">off</span>;</span><br><span class="line">是否缓存查找时发生错误的文件一类的信息</span><br><span class="line">默认值为<span class="keyword">off</span></span><br></pre></td></tr></table></figure>
<h3 id="open-file-cache-min-uses"><a href="#open-file-cache-min-uses" class="headerlink" title="open_file_cache_min_uses"></a>open_file_cache_min_uses</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">open_file_cache_min_uses  number<span class="comment">;</span></span><br><span class="line">open_file_cache指令的inactive参数指定的时长内，至少被命中此处指定的次数，方可被归类为活动项</span><br><span class="line">默认值为<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="open-file-cache-valid"><a href="#open-file-cache-valid" class="headerlink" title="open_file_cache_valid"></a>open_file_cache_valid</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">open_file_cache_valid time<span class="comment">;</span></span><br><span class="line">缓存项有效性的检查频率</span><br><span class="line">默认值为<span class="number">60</span>s</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="ngx-http-access-module"><a href="#ngx-http-access-module" class="headerlink" title="ngx_http_access_module"></a>ngx_http_access_module</h1><h2 id="实现基于ip的访问控制功能"><a href="#实现基于ip的访问控制功能" class="headerlink" title="实现基于ip的访问控制功能"></a>实现基于ip的访问控制功能</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1、allow<span class="built_in"> address </span>| CIDR | unix: | all;</span><br><span class="line">2、deny<span class="built_in"> address </span>| CIDR | unix: | all;</span><br><span class="line">   http, server, location, limit_except</span><br><span class="line">   自上而下检查，一旦匹配，将生效，条件严格的置前</span><br><span class="line">例:</span><br><span class="line">   location / &#123;</span><br><span class="line">      deny  192.168.1.1;</span><br><span class="line">      allow 192.168.1.0/24;</span><br><span class="line">      allow 10.1.1.0/16;</span><br><span class="line">      allow 2001:0db8::/32; </span><br><span class="line">      deny  all;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-auth-basic-module"><a href="#ngx-http-auth-basic-module" class="headerlink" title="ngx_http_auth_basic_module"></a>ngx_http_auth_basic_module</h1><h2 id="实现基于用户的访问控制，使用basic机制进行用户认证"><a href="#实现基于用户的访问控制，使用basic机制进行用户认证" class="headerlink" title="实现基于用户的访问控制，使用basic机制进行用户认证"></a>实现基于用户的访问控制，使用basic机制进行用户认证</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、auth_basic <span class="keyword">string</span> | off;</span><br><span class="line"><span class="number">2</span>、auth_basic_user_file file;</span><br><span class="line"></span><br><span class="line"><span class="keyword">location</span> <span class="title">/admin</span>/ &#123;</span><br><span class="line">   auth_basic <span class="string">"Admin Area"</span>;</span><br><span class="line">   auth_basic_user_file /etc/nginx/.httpwd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">用户口令</span><br><span class="line">   明文文本: 格式name:password:comment</span><br><span class="line">   加密文本: 由htpasswd命令实现</span><br><span class="line">   <span class="comment"># httpd-tools所提供</span></span><br><span class="line"></span><br><span class="line">htpasswd -c -m .httppw xdg  <span class="comment"># .htpasswd --&gt; 密码文件</span></span><br><span class="line">htpasswd -m .httppw xdg1</span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-stub-status-module"><a href="#ngx-http-stub-status-module" class="headerlink" title="ngx_http_stub_status_module"></a>ngx_http_stub_status_module</h1><h2 id="用于输出nginx的基本状态信息"><a href="#用于输出nginx的基本状态信息" class="headerlink" title="用于输出nginx的基本状态信息"></a>用于输出nginx的基本状态信息</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">输出信息示例</span></span><br><span class="line">   <span class="string">Active</span> <span class="attr">connections:</span> <span class="number">291</span></span><br><span class="line">   <span class="string">server</span> <span class="string">accepts</span> <span class="string">handled</span> <span class="string">requests</span> <span class="number">16630948</span> <span class="number">16630948</span> <span class="number">31070465</span></span><br><span class="line">   <span class="string">对应上面accepts，handled，requests三个值</span></span><br><span class="line"><span class="attr">      Reading:</span> <span class="number">6</span> <span class="attr">Writing:</span> <span class="number">179</span> <span class="attr">Waiting:</span> <span class="number">106</span></span><br><span class="line"></span><br><span class="line"><span class="string">Active</span> <span class="attr">connections:</span> <span class="string">当前状态，活动状态的连接数</span></span><br><span class="line"><span class="attr">accepts:</span> <span class="string">统计总值，已经接受的客户端请求的总数</span></span><br><span class="line"><span class="attr">handled:</span> <span class="string">统计总值，已经处理完成的客户端请求的总数</span></span><br><span class="line"><span class="attr">requests:</span> <span class="string">统计总值，客户端发来的总的请求数</span></span><br><span class="line"><span class="attr">Reading:</span> <span class="string">当前状态，正在读取客户端请求报文首部的连接的连接数</span></span><br><span class="line"><span class="attr">Writing:</span> <span class="string">当前状态，正在向客户端发送响应报文过程中的连接数</span></span><br><span class="line"><span class="attr">Waiting:</span> <span class="string">当前状态，正在等待客户端发出请求的空闲连接数</span></span><br><span class="line"></span><br><span class="line"><span class="string">stub_status;</span></span><br><span class="line">   <span class="string">location</span>  <span class="string">/status</span> <span class="string">&#123;</span></span><br><span class="line">      <span class="string">stub_status;</span></span><br><span class="line">      <span class="string">allow</span> <span class="number">172.16</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16;</span></span><br><span class="line">      <span class="string">deny</span> <span class="string">all;</span></span><br><span class="line">   <span class="string">&#125;</span></span><br><span class="line"><span class="comment"># 状态信息的隐蔽性，指定某个主机可以查看</span></span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-log-module"><a href="#ngx-http-log-module" class="headerlink" title="ngx_http_log_module"></a>ngx_http_log_module</h1><h2 id="指定日志格式记录请求"><a href="#指定日志格式记录请求" class="headerlink" title="指定日志格式记录请求"></a>指定日志格式记录请求</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、log_format name <span class="built_in">string</span> ...;</span><br><span class="line">   <span class="built_in">string</span>可以使用nginx核心模块及其它模块内嵌的变量</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、access_log <span class="built_in">path</span> [<span class="built_in">format</span> [buffer=size] [gzip[=level]] [<span class="built_in">flush</span>=<span class="built_in">time</span>] [<span class="keyword">if</span>=condition]];</span><br><span class="line">   access_log off;  # 关闭访问日志</span><br><span class="line">   访问日志文件路径，格式及相关的缓冲的配置</span><br><span class="line">      buffer=size</span><br><span class="line">      <span class="built_in">flush</span>=<span class="built_in">time</span>  # 多长时间清除</span><br><span class="line">例:</span><br><span class="line">log_format compression <span class="string">'$remote_addr-$remote_user [$time_local] '</span> <span class="string">'"$request" $status $bytes_sent '</span> <span class="string">'"$http_referer" "$http_user_agent" "$gzip_ratio"'</span>;</span><br><span class="line"></span><br><span class="line">access_log  /spool/logs/nginx-access.<span class="built_in">log</span>  compression  buffer=<span class="number">32</span>k;</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、open_log_file_cache <span class="built_in">max</span>=N [inactive=<span class="built_in">time</span>] [min_uses=N] [valid=<span class="built_in">time</span>];</span><br><span class="line">   open_log_file_cache off;</span><br><span class="line">   缓存各日志文件相关的元数据信息</span><br><span class="line">   <span class="built_in">max</span>: 缓存的最大文件描述符数量</span><br><span class="line">   min_uses: 在inactive指定的时长内访问大于等于此值方可被当作活动项</span><br><span class="line">      inactive: 非活动时长</span><br><span class="line">      valid: 验正缓存中各缓存项是否为活动项的时间间隔</span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-gzip-module"><a href="#ngx-http-gzip-module" class="headerlink" title="ngx_http_gzip_module"></a>ngx_http_gzip_module</h1><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">用gzip方法压缩响应数据，节约带宽</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、gzip <span class="keyword">on</span> | off;</span><br><span class="line">   启用或禁用gzip压缩</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、gzip_comp_level level;</span><br><span class="line">   压缩比由低到高: <span class="number">1</span> 到 <span class="number">9</span></span><br><span class="line">   默认: <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、gzip_disable regex ...;</span><br><span class="line">   匹配到客户端浏览器不执行压缩</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、gzip_min_length <span class="built_in">length</span>;</span><br><span class="line">   启用压缩功能的响应报文大小阈值</span><br><span class="line">   <span class="comment"># 比如很小的文件就不用压缩了，压缩之后比原来的文件还要大</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>、gzip_http_version <span class="number">1.0</span> | <span class="number">1.1</span>;</span><br><span class="line">   设定启用压缩功能时，协议的最小版本</span><br><span class="line">   默认: <span class="number">1.1</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span>、gzip_buffers <span class="built_in">number</span> size;</span><br><span class="line">   支持实现压缩功能时缓冲区数量及每个缓存区的大小</span><br><span class="line">   默认: <span class="number">32</span> <span class="number">4</span>k 或 <span class="number">16</span> <span class="number">8</span>k</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>、gzip_types  mime-type ...;</span><br><span class="line">   指明仅对哪些类型的资源执行压缩操作，即压缩过滤器</span><br><span class="line">   <span class="comment"># 默认包含有 text/html，不用显示指定，否则出错</span></span><br><span class="line">   <span class="comment"># nginx里有自己支持的文件格式 /etc/nginx/mine.types</span></span><br><span class="line"></span><br><span class="line"><span class="number">8</span>、gzip_vary <span class="keyword">on</span> | off;</span><br><span class="line">   如果启用压缩，是否在响应报文首部插入<span class="string">"Vary: AcceptEncoding"</span></span><br><span class="line">   默认是显示的</span><br><span class="line"></span><br><span class="line"><span class="number">9</span>、gzip_proxied off | expired | no-cache | no-store | private | </span><br><span class="line">   no_last_modified | no_etag | auth | any ...;</span><br><span class="line"></span><br><span class="line">nginx对于代理服务器请求的响应报文，在何种条件下启用压缩功能</span><br><span class="line">   off: 对被代理的请求不启用压缩</span><br><span class="line">expired，no-cache，no-store，private: 代理服务器请求的响应报文首部Cache-Control值，任何一个，启用压缩功能</span><br><span class="line"><span class="comment"># 在做为代理服务器的时候，做代理时，访问RS的时候返回的数据头信息里，包含上面的几个字段信息中的任何一个，就启用压缩功能</span></span><br><span class="line">例:</span><br><span class="line">   gzip <span class="keyword">on</span>;</span><br><span class="line">   gzip_comp_level <span class="number">6</span>;</span><br><span class="line">   gzip_min_length <span class="number">64</span>;</span><br><span class="line">   gzip_proxied any;</span><br><span class="line">   gzip_types  <span class="built_in">text</span>/xml  <span class="built_in">text</span>/css  <span class="built_in">application</span>/javascript;</span><br><span class="line">   <span class="comment"># 显示的时候会出现 Content-Encoding: gzip，不会显示具体压缩的字节数</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="ngx-http-ssl-module"><a href="#ngx-http-ssl-module" class="headerlink" title="ngx_http_ssl_module"></a>ngx_http_ssl_module</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1、ssl on | off;</span><br><span class="line">   为指定虚拟机启用HTTPS protocol，建议用listen指令代替</span><br><span class="line"></span><br><span class="line">2、ssl_certificate  file;</span><br><span class="line">   当前虚拟主机使用PEM格式的证书文件</span><br><span class="line"></span><br><span class="line">3、ssl_certificate_key  file;</span><br><span class="line">   当前虚拟主机上与其证书匹配的私钥文件</span><br><span class="line"></span><br><span class="line">4、ssl_protocols [SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2];</span><br><span class="line">   支持ssl协议版本，默认为后三个</span><br><span class="line"></span><br><span class="line">5、ssl_session_cache off | none | [builtin[:size]] [shared:name:size];</span><br><span class="line">   builtin[:size]: 使用OpenSSL内建缓存，为每worker进程私有</span><br><span class="line">   [shared:name:size]: 在各worker之间使用一个共享的缓存</span><br><span class="line">例:</span><br><span class="line">   ssl_session_cache  builtin:1000  shared:SSL:10m;</span><br><span class="line"></span><br><span class="line">6、ssl_session_timeout time;</span><br><span class="line">   客户端连接可以复用ssl session cache中缓存的ssl参数的有效时长，默认5m</span><br><span class="line">例:</span><br><span class="line">  <span class="built_in"> server </span>&#123; </span><br><span class="line">      listen 443 ssl; </span><br><span class="line">      server_name www.a.com; </span><br><span class="line">      root /vhosts/ssl/htdocs; </span><br><span class="line">      ssl on; </span><br><span class="line">      ssl_certificate /etc/nginx/ssl/nginx.crt; # 证书文件</span><br><span class="line">      ssl_certificate_key /etc/nginx/ssl/nginx.key; # key的文件</span><br><span class="line">      ssl_session_cache shared:sslcache:20m; </span><br><span class="line">      ssl_session_timeout 10m; </span><br><span class="line">   &#125;</span><br><span class="line">例: 创建一个自签名证书</span><br><span class="line">   cd /etc/pki/tls/certs</span><br><span class="line">   make nginx.crt  # 密码是必须要输入的</span><br><span class="line">   # 填写相关信息</span><br><span class="line">   openssl rsa -in nginx.key -out nginx.key</span><br><span class="line">   # 把之前的密码密钥给消除掉（不然每次启动服务的时候，都会要求输入密码）</span><br><span class="line"></span><br><span class="line">在nginx当中可以在一个端口上支持多个https的加密</span><br><span class="line">   nginx -V  # 查看编译的时候指定的相关特性和功能</span><br><span class="line">   TLS SNI support enabled  # 当中的SNI 就是这个功能<span class="built_in"> server </span>name indication</span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-rewrite-module"><a href="#ngx-http-rewrite-module" class="headerlink" title="ngx_http_rewrite_module"></a>ngx_http_rewrite_module</h1><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Context: server, location, <span class="keyword">if</span></span><br><span class="line">The ngx_http_rewrite_module module is used <span class="built_in">to</span> change request URI <span class="keyword">using</span> PCRE regular expressions, <span class="literal">return</span> redirects, <span class="keyword">and</span> conditionally select configurations.</span><br><span class="line"></span><br><span class="line">将用户请求的URI基于PCRE regex所描述的模式进行检查，而后完成重定向替换</span><br><span class="line">例:</span><br><span class="line">   <span class="keyword">http</span>://www.<span class="keyword">a</span>.com/hn <span class="comment">--&gt; http://www.a.com/henan</span></span><br><span class="line">   <span class="keyword">http</span>://www.<span class="keyword">a</span>.com <span class="comment">--&gt; https://www.a.com/</span></span><br></pre></td></tr></table></figure>
<h2 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">rewrite  regex  replacement  [flag]</span><br><span class="line">   将用户请求的URI基于regex所描述的模式进行检查，匹配到时将其替换为replacement，指定的新的URI</span><br><span class="line"><span class="meta"># 如果在同一级配置块中存在多个rewrite规则，那么会自下而下逐个检查，被某条件规则替换完成后，会重新一轮的替换检查</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 隐含有循环机制，但不超过10次，如果超过，提示500响应码，[flag]所表示的标志位用于控制此循环机制</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 如果replacement是以http:<span class="comment">//或https://开头，则替换结果会直接以重向返回给客户端</span></span></span><br><span class="line"><span class="meta"># 301: 永久重定向</span></span><br><span class="line"></span><br><span class="line">[flag]</span><br><span class="line"><span class="symbol">   last:</span> 重写完成后停止对当前URI在当前location中后续的其它重写操作，而后对新的URI启动新一轮重写检查，提前重启新一轮循环</span><br><span class="line">   <span class="meta"># 匹配到了last，则重来一轮循环，会造成死循环，要指定其访问次数</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">   break:</span> 重写完成后停止对当前URI在当前location中后续的其它重写操作，而后直接跳转至重写规则配置块之后的其它配置，结束循环，建议在location中使用</span><br><span class="line"></span><br><span class="line"><span class="symbol">   redirect:</span> 临时重定向，重写完成后以临时重定向方式直接返回重写后生成的新URI给客户端，由客户端重新发起请求，不能以http:<span class="comment">//或https://开头，使用相对路径，</span></span><br><span class="line">     状态码: <span class="number">302</span></span><br><span class="line">	</span><br><span class="line"><span class="symbol">   permanent:</span> 重写完成后以永久重定向方式直接返回重写后生成的新URI给客户端，由客户端重新发起请求，状态码: <span class="number">301</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># last、break: 两者是在内部做的替换，客户端是不知道的</span></span><br><span class="line"><span class="meta"># redirect、permanent: 两者在服务器返回给客户端的信息状态码(301、302)，然而客户端再从新提出访问请求</span></span><br><span class="line">例:</span><br><span class="line">   rewrite ^<span class="meta-keyword">/xdg/</span>(.*)$  <span class="meta-keyword">/xudingguo/</span>$<span class="number">1</span>  last;</span><br><span class="line">   <span class="meta"># 重定向目录之后文件路径，要做正则表达式的匹配</span></span><br><span class="line">   <span class="meta"># curl http:<span class="comment">//ip/xdg 之后页面的地址还是 http://ip/xdg，服务器内部发生的改变</span></span></span><br><span class="line"></span><br><span class="line">   rewrite ^<span class="meta-keyword">/xdg/</span>(.*)$  <span class="meta-keyword">/xudingguo/</span>$<span class="number">1</span>  redirect;</span><br><span class="line">   <span class="meta"># curl http:<span class="comment">//ip/xdg 之后页面的地址是 http://ip/xudingguo，客户端重新发生的请求</span></span></span><br><span class="line"></span><br><span class="line">例:</span><br><span class="line">   location /<span class="class">xdg </span>&#123;</span><br><span class="line">      rewrite  ^<span class="meta-keyword">/xdg/</span>(.*)$  <span class="meta-keyword">/xudingguo/</span>$<span class="number">1</span>  permanent ;</span><br><span class="line">      root <span class="meta-keyword">/app/</span>xdg ;</span><br><span class="line">      <span class="meta"># 实际访问的地址是 /app/xdg/xdg 二层的xdg的访问才会跳转，前面的是根</span></span><br><span class="line">   &#125;</span><br><span class="line">   location /<span class="class">xudingguo </span>&#123;</span><br><span class="line">      alias <span class="meta-keyword">/app/</span>xudingguo ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta"># 当用记访问 curl http:<span class="comment">//ip/xdg，这是会跳转到 http://ip/xudingguo这个目录下</span></span></span><br></pre></td></tr></table></figure>
<h2 id="return"><a href="#return" class="headerlink" title="return"></a>return</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">return</span> code [<span class="keyword">text</span>];  <span class="comment"># 返回 状态码  字符串</span></span><br><span class="line"><span class="literal">return</span> code <span class="built_in">URL</span>;  <span class="comment"># 返回 状态码  URL</span></span><br><span class="line"><span class="literal">return</span> <span class="built_in">URL</span>;  <span class="comment"># 直接返回一个URL</span></span><br><span class="line"><span class="comment"># 停止处理，并返回给客户端指定的响应码</span></span><br><span class="line"><span class="comment"># 如果返回的错误代码是4xx的话，后面的URL会被识别成字符串来显示，而不是URL</span></span><br></pre></td></tr></table></figure>
<h2 id="rewrite-log"><a href="#rewrite-log" class="headerlink" title="rewrite_log"></a>rewrite_log</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rewrite_log <span class="keyword">on</span> | off;</span><br><span class="line">是否开启重写日志，发送至error_log（notice level）</span><br></pre></td></tr></table></figure>
<h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>  $<span class="keyword">variable</span>  <span class="comment">value</span>;</span><br><span class="line">用户自定义变量</span><br><span class="line"># 变量定义和调用都要以<span class="symbol">$</span>开头</span><br></pre></td></tr></table></figure>
<h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) &#123; ... &#125;</span><br><span class="line">引入新的上下文，条件满足时，执行配置块中的配置指令，server, location</span><br><span class="line">   condition:</span><br><span class="line">      比较操作符:</span><br><span class="line">         ==: 相同</span><br><span class="line">         !=: 不同</span><br><span class="line">         ~: 模式匹配，区分字符大小写</span><br><span class="line">         ~*: 模式匹配，不区分字符大小写</span><br><span class="line">         !~: 模式不匹配，区分字符大小写</span><br><span class="line">         !~*: 模式不匹配，不区分字符大小写</span><br><span class="line">      文件及目录存在性判断:</span><br><span class="line">         -e, !-e 存在（包括文件，目录，软链接）</span><br><span class="line">         -f, !-f 文件</span><br><span class="line">         -d, !-d 目录</span><br><span class="line">         -x, !-x 执行</span><br><span class="line">例:</span><br><span class="line">   <span class="keyword">if</span> ($http_user_agent ~ MSIE) &#123;</span><br><span class="line">      rewrite ^(.*)$ /msie/$1 break;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ($http_cookie ~* <span class="string">"id=([^;]+)(?:;|$)"</span>) &#123;</span><br><span class="line">      set $id $1;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ($request_method = POST) &#123;</span><br><span class="line">      return <span class="number">405</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ($slow) &#123;</span><br><span class="line">      limit_rate <span class="number">10</span>k;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ($invalid_referer) &#123;</span><br><span class="line">      return <span class="number">403</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-referer-module"><a href="#ngx-http-referer-module" class="headerlink" title="ngx_http_referer_module"></a>ngx_http_referer_module</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">The ngx_http_referer_module module is used <span class="keyword">to</span> block access <span class="keyword">to</span> a site <span class="keyword">for</span> requests <span class="keyword">with</span> invalid values <span class="keyword">in</span> the <span class="string">"Referer"</span> header field. </span><br><span class="line"><span class="meta"># 可防止盗链</span></span><br><span class="line"></span><br><span class="line">valid_referers  none|blocked|server_names|<span class="built_in">string</span> ...<span class="comment">;</span></span><br><span class="line"><span class="meta"># 定义referer首部的合法可用值，不能匹配的将是非法值</span></span><br><span class="line">   none: 请求报文首部没有referer首部  <span class="meta"># <span class="string">"-"</span> 字段的内容</span></span><br><span class="line">   blocked: 请求报文有referer首部，但无有效值  <span class="meta"># <span class="string">"server_names"</span> 字段的内容</span></span><br><span class="line">   server_names: 参数，其可以有值作为主机名或主机名模式</span><br><span class="line">   arbitrary_string: 任意字符串，但可使用*作通配符</span><br><span class="line">   regular expression: 被指定的正则表达式模式匹配到的字符串,要使用~开头</span><br><span class="line">   <span class="meta"># 如: ~.*\.xdg\.com</span></span><br><span class="line">例:</span><br><span class="line">   valid_referers  none  block  server_names  *.xdg.com  *.xdg.com  xdg.*  xdg.*  ~\.xdg\.<span class="comment">;</span></span><br><span class="line">   <span class="keyword">if</span> ($invalid_referer) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">403</span><span class="comment">;</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-proxy-module"><a href="#ngx-http-proxy-module" class="headerlink" title="ngx_http_proxy_module"></a>ngx_http_proxy_module</h1><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The ngx_http_proxy_module <span class="class"><span class="keyword">module</span> <span class="title">allows</span> <span class="title">passing</span> <span class="title">requests</span> <span class="title">to</span> <span class="title">another</span> <span class="title">server</span>.</span></span><br></pre></td></tr></table></figure>
<h2 id="proxy-pass"><a href="#proxy-pass" class="headerlink" title="proxy_pass"></a>proxy_pass</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">proxy_pass URL;</span><br><span class="line">   Context:location, <span class="keyword">if</span> <span class="keyword">in</span> location, limit_except</span><br><span class="line"></span><br><span class="line">proxy_pass后面的路径不带uri时，会将location的uri传递给后端主机</span><br><span class="line">   server &#123;</span><br><span class="line">      ...</span><br><span class="line">      server_name HOSTNAME;</span><br><span class="line">      location /uri/ &#123;</span><br><span class="line">         proxy_pass http:<span class="comment">//host[:port];  # 最后没有 /</span></span><br><span class="line">         # 访问的是目标主机主站点下的 /uri目录下文件或目录</span><br><span class="line">         # 本机: http:<span class="comment">//ip/uri/a.txt</span></span><br><span class="line">         # 跳转到目标上的文件是: http:<span class="comment">//dip/uri/a.txt</span></span><br><span class="line">            # uri和a.txt还是自己输入的路径信息，在目标主机上还是同样的路径</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">proxy_pass后面的路径是一个uri时，会将location的uri替换为proxy_pass的uri</span><br><span class="line">   server &#123;</span><br><span class="line">      ...</span><br><span class="line">      server_name HOSTNAME;</span><br><span class="line">      location /uri/ &#123;</span><br><span class="line">         proxy_pass http:<span class="comment">//host/new_uri/;  # 最后加了 /</span></span><br><span class="line">         # 访问的直接是目标站点下的文件</span><br><span class="line">         # 本机: 如果要跳转，就要访问/uri目录，才能跳转</span><br><span class="line">         # 目标上: 原来http:<span class="comment">//ip/uri 这个路径 --&gt; 代表目标主机下的主站点目录</span></span><br><span class="line">         #    代表http:<span class="comment">//dip/ 这个目录下的根</span></span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">如果location定义其uri时使用了正则表达式的模式，则proxy_pass之后必须不能使用uri;</span><br><span class="line">  用户请求时传递的uri将直接附加代理到的服务之后</span><br><span class="line">   server &#123;</span><br><span class="line">      ...</span><br><span class="line">      server_name HOSTNAME;</span><br><span class="line">      location ~|~* \.jpg$ &#123;  # uri</span><br><span class="line">         proxy_pass  http:<span class="comment">//host;  # 不能加 / ，语法则有问题</span></span><br><span class="line">         # 使用的正则表达式，所以proxy_pass之后不能使用 /</span><br><span class="line">         # 本机: http:<span class="comment">//ip/uri/a.jpg</span></span><br><span class="line">         # 目标主机访问的地址是: http:<span class="comment">//dip/uri/a.jpg 这个路径下的文件</span></span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="proxy-set-header"><a href="#proxy-set-header" class="headerlink" title="proxy_set_header"></a>proxy_set_header</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header field value<span class="comment">;</span></span><br><span class="line">设定发往后端主机的请求报文的请求首部的值</span><br><span class="line">   Context: http, server, location</span><br><span class="line">   proxy_set_header  X-Real-IP   $remote_addr<span class="comment">;</span></span><br><span class="line">   proxy_set_header  X-Forwarded-<span class="keyword">For</span>  $proxy_add_x_forwarded_for<span class="comment">;</span></span><br><span class="line">   <span class="meta"># 修改的格式:</span></span><br><span class="line">      httpd服务上: %h 表示的是客户端的地址 --&gt;  %&#123;xdg_head&#125;i</span><br><span class="line">      <span class="meta"># 首部信息必须加 i</span></span><br><span class="line">      nginx服务上:</span><br><span class="line">   标准格式如下:</span><br><span class="line">      X-Forwarded-<span class="keyword">For</span>: client1, proxy1, proxy2</span><br></pre></td></tr></table></figure>
<h2 id="proxy-cache-path"><a href="#proxy-cache-path" class="headerlink" title="proxy_cache_path"></a>proxy_cache_path</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">定义可用于proxy功能的缓存: Context:http</span><br><span class="line">   proxy_cache_path path [<span class="attribute">levels</span>=levels] [<span class="attribute">use_temp_path</span>=on|off] </span><br><span class="line">     <span class="attribute">keys_zone</span>=name:size [<span class="attribute">inactive</span>=time] [<span class="attribute">max_size</span>=size] [<span class="attribute">manager_files</span>=number]</span><br><span class="line">     [<span class="attribute">manager_sleep</span>=time] [<span class="attribute">manager_threshold</span>=time] [<span class="attribute">loader_files</span>=number] </span><br><span class="line">     [<span class="attribute">loader_sleep</span>=time] [<span class="attribute">loader_threshold</span>=time] [<span class="attribute">purger</span>=on|off] </span><br><span class="line">     [<span class="attribute">purger_files</span>=number] [<span class="attribute">purger_sleep</span>=time] [<span class="attribute">purger_threshold</span>=time];</span><br></pre></td></tr></table></figure>
<h2 id="proxy-cache"><a href="#proxy-cache" class="headerlink" title="proxy_cache"></a>proxy_cache</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache zone | <span class="keyword">off</span>;</span><br><span class="line">默认<span class="keyword">off</span>，指明调用的缓存，或关闭缓存机制</span><br><span class="line">Context: http, server, location</span><br></pre></td></tr></table></figure>
<h2 id="proxy-cache-key"><a href="#proxy-cache-key" class="headerlink" title="proxy_cache_key"></a>proxy_cache_key</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_key <span class="built_in">string</span><span class="comment">;</span></span><br><span class="line">缓存中用于<span class="string">"键"</span>的内容</span><br><span class="line">默认值: proxy_cache_key $scheme$proxy_host$request_uri<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h2 id="proxy-cache-valid"><a href="#proxy-cache-valid" class="headerlink" title="proxy_cache_valid"></a>proxy_cache_valid</h2><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_valid [code ...] time;</span><br><span class="line">定义对特定响应码的响应内容的缓存时长</span><br><span class="line">定义在http<span class="meta">&#123;...&#125;</span>中</span><br><span class="line">例:</span><br><span class="line">   proxy_cache_valid <span class="number">200</span> <span class="number">302</span> <span class="number">10</span>m;</span><br><span class="line">   proxy_cache_valid <span class="number">404</span> <span class="number">1</span>m;</span><br><span class="line"></span><br><span class="line">例:</span><br><span class="line">在http配置定义缓存 http字段当中</span><br><span class="line">   proxy_cache_path  /<span class="keyword">var</span>/cache/nginx/proxy_cache  levels=<span class="number">1</span>:<span class="number">1</span>:<span class="number">1</span> </span><br><span class="line">     keys_zone=proxycache:<span class="number">20</span>m  inactive=<span class="number">120</span>s  max_size=<span class="number">1</span>g;</span><br><span class="line"></span><br><span class="line">调用缓存功能，需要定义在相应的配置段，如: server<span class="meta">&#123;...&#125;</span></span><br><span class="line">   proxy_cache proxycache;  <span class="comment"># 指定的名字</span></span><br><span class="line">   proxy_cache_key $request_uri;</span><br><span class="line">   proxy_cache_valid <span class="number">200</span> <span class="number">302</span> <span class="number">301</span> <span class="number">1</span>h;  <span class="comment"># 指定响应码缓存多长时间</span></span><br><span class="line">   proxy_cache_valid <span class="built_in">any</span> <span class="number">1</span>m;  <span class="comment"># 其它响应码缓存的时间</span></span><br><span class="line"><span class="comment"># 这是代理的缓存服务器，只缓存代理的数据，不缓存代理服务器上的数据</span></span><br></pre></td></tr></table></figure>
<h2 id="proxy-cache-use-stale"><a href="#proxy-cache-use-stale" class="headerlink" title="proxy_cache_use_stale"></a>proxy_cache_use_stale</h2><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_use_stale error | <span class="type">timeout</span> | <span class="type">invalid_header</span> | <span class="type">updating</span> | <span class="type">http_500</span> </span><br><span class="line">  | <span class="type">http_502</span> | <span class="type">http_503</span> | <span class="type">http_504</span> | <span class="type">http_403</span> | <span class="type">http_404</span> | <span class="type">off</span> ...</span><br><span class="line"># 在被代理的后端服务器出现哪种情况下，可以直接使用过期的缓存响应客户端</span><br></pre></td></tr></table></figure>
<h2 id="proxy-cache-methods"><a href="#proxy-cache-methods" class="headerlink" title="proxy_cache_methods"></a>proxy_cache_methods</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_methods <span class="builtin-name">GET</span> | HEAD | POST <span class="built_in">..</span>.;</span><br><span class="line"><span class="comment"># 对哪些客户端请求方法对应的响应进行缓存，GET 和 HEAD方法总是被缓存</span></span><br><span class="line"><span class="comment"># 默认GET就会被缓存</span></span><br></pre></td></tr></table></figure>
<h2 id="proxy-hide-header"><a href="#proxy-hide-header" class="headerlink" title="proxy_hide_header"></a>proxy_hide_header</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxy_hide_header field;</span><br><span class="line">By default, nginx does <span class="keyword">not</span> pass the header fields <span class="string">"Date"</span>, <span class="string">"Server"</span>, <span class="string">"X-Pad"</span>, </span><br><span class="line">  <span class="keyword">and</span> <span class="string">"X-Accel-..."</span> <span class="keyword">from</span> the response of a proxied<span class="built_in"> server </span><span class="keyword">to</span> a client.</span><br><span class="line"><span class="comment"># 用于隐藏后端服务器特定的响应首部</span></span><br><span class="line"><span class="comment"># 用户访问的代理服务器后的RS服务器，而代理服务器把后面的RS服务器做了隐藏</span></span><br></pre></td></tr></table></figure>
<h2 id="proxy-connect-timeout"><a href="#proxy-connect-timeout" class="headerlink" title="proxy_connect_timeout"></a>proxy_connect_timeout</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_connect_timeout time;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义与后端服务器建立连接的超时时长，如: 超时会出现 502 错误</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认为60s，一般不建议超出75s</span></span><br></pre></td></tr></table></figure>
<h2 id="proxy-send-timeout"><a href="#proxy-send-timeout" class="headerlink" title="proxy_send_timeout"></a>proxy_send_timeout</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_send_timeout time;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 把请求发送给后端服务器的超时时长</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认为60s</span></span><br></pre></td></tr></table></figure>
<h2 id="proxy-read-timeout"><a href="#proxy-read-timeout" class="headerlink" title="proxy_read_timeout"></a>proxy_read_timeout</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_read_timeout time;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 等待后端服务器发送响应报文的超时时长</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认为60s</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="ngx-http-headers-module"><a href="#ngx-http-headers-module" class="headerlink" title="ngx_http_headers_module"></a>ngx_http_headers_module</h1><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">向由代理服务器响应给客户端的响应报文添加自定义首部，或修改指定首部的值</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_header </span> name  value [always]<span class="comment">;</span></span><br><span class="line">   <span class="comment"># 添加自定义首部</span></span><br><span class="line">   <span class="keyword">add_header </span>X-Via  $server_addr<span class="comment">;</span></span><br><span class="line">   <span class="keyword">add_header </span>X-<span class="keyword">Cache </span>$upstream_cache_status<span class="comment">;</span></span><br><span class="line">   <span class="keyword">add_header </span>X-Accel $server_name<span class="comment">;</span></span><br><span class="line"><span class="comment"># 如果定义与原来信息字段相同的，没替换系统自定义的字段，两个字段信息都会显示出来</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_trailer </span> name  value [always]<span class="comment">;</span></span><br><span class="line">   <span class="comment"># 添加自定义响应信息的尾部</span></span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-fastcgi-module"><a href="#ngx-http-fastcgi-module" class="headerlink" title="ngx_http_fastcgi_module"></a>ngx_http_fastcgi_module</h1><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">转发请求到FastCGI服务器，不支持php模块方式</span><br><span class="line"><span class="comment"># 必须是单独运行fastcgi模式支持php程序才可以</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、fastcgi_pass address;</span><br><span class="line">   address为后端的fastcgi server的地址</span><br><span class="line">   可用位置: location, <span class="keyword">if</span> <span class="keyword">in</span> location</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、fastcgi_index name;</span><br><span class="line">   fastcgi默认的主页资源</span><br><span class="line">例:</span><br><span class="line">   fastcgi_index  index.php;</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、fastcgi_param   parameter  value [if_not_empty];</span><br><span class="line">   设置传递给FastCGI服务器的参数值，可以是文本，变量或组合</span><br><span class="line">例<span class="number">1</span>:</span><br><span class="line">   (<span class="number">1</span>) 在后端服务器先配置fpm server和mariadb-server</span><br><span class="line">   (<span class="number">2</span>) 在前端nginx服务上做以下配置</span><br><span class="line">      location ~* \.php$ &#123;</span><br><span class="line">         fastcgi_pass 后端fpm服务器IP:<span class="number">9000</span>;  <span class="comment"># 端口必须指定</span></span><br><span class="line">         fastcgi_index index.php;</span><br><span class="line">         fastcgi_param  SCRIPT_FILENAME  /app/phpdir/$fastcgi_script_name;</span><br><span class="line">         <span class="comment"># $前面不加/，自动添加</span></span><br><span class="line">         <span class="comment"># /app/phpdir/指是php服务器上存放php页面的路径</span></span><br><span class="line">         include  fastcgi_params;</span><br><span class="line">         ...</span><br><span class="line">      &#125;</span><br><span class="line">$fastcgi_script_name  <span class="comment"># 定义好的变量</span></span><br><span class="line">SCRIPT_FILENAME  <span class="comment"># 自定义好的变量</span></span><br><span class="line">include  fastcgi_params  <span class="comment"># 都在这个文件当中</span></span><br><span class="line"></span><br><span class="line">curl http://ip/index.php自动跳转到fastcgi上，目录/app/phpdir下的index.php文件</span><br><span class="line"><span class="comment"># 安装完成之后，修改端口配置文件 --&gt; /etc/php-fpm.d/www.conf</span></span><br><span class="line"></span><br><span class="line">   pm.<span class="attr">status_path</span> = /status  <span class="comment"># 开启查看状态的页面功能，名字可以自己自定义</span></span><br><span class="line">   ping.<span class="attr">path</span> = /ping  <span class="comment"># 健康性检测</span></span><br><span class="line">   ping.<span class="attr">response</span> = pong</span><br><span class="line"></span><br><span class="line">例<span class="number">2</span>:</span><br><span class="line">通过/pm_status和/ping来获取fpm server状态信息</span><br><span class="line">   location ~* ^/(pm_status|ping)$ &#123;</span><br><span class="line">      include  fastcgi_params;</span><br><span class="line">      fastcgi_pass 后端fpm服务器IP:<span class="number">9000</span>;</span><br><span class="line">      fastcgi_param SCRIPT_FILENAME  $fastcgi_script_name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、fastcgi_cache_path path [<span class="attr">levels=levels]</span> [<span class="attr">use_temp_path=on|off]</span> </span><br><span class="line">  <span class="attr">keys_zone=name:size</span> [<span class="attr">inactive=time]</span> [<span class="attr">max_size=size]</span> [<span class="attr">manager_files=number]</span> </span><br><span class="line">  [<span class="attr">manager_sleep=time]</span> [<span class="attr">manager_threshold=time]</span> [<span class="attr">loader_files=number]</span> </span><br><span class="line">  [<span class="attr">loader_sleep=time]</span> [<span class="attr">loader_threshold=time]</span> [<span class="attr">purger=on|off]</span> </span><br><span class="line">  [<span class="attr">purger_files=number]</span> [<span class="attr">purger_sleep=time]</span> [<span class="attr">purger_threshold=time];</span></span><br><span class="line"></span><br><span class="line">定义fastcgi的缓存</span><br><span class="line">   path  <span class="comment"># 缓存位置为磁盘上的文件系统</span></span><br><span class="line">   <span class="attr">max_size=size</span>  <span class="comment"># 磁盘path路径中用于缓存数据的缓存空间上限</span></span><br><span class="line">   <span class="attr">levels=levels</span>  <span class="comment"># 缓存目录的层级数量，以及每一级的目录数量</span></span><br><span class="line">   <span class="attr">levels=ONE:TWO:THREE</span></span><br><span class="line">例:</span><br><span class="line">   <span class="attr">leves=1:2:2</span></span><br><span class="line">   <span class="attr">keys_zone=name:size</span></span><br><span class="line">      k/v映射的内存空间的名称及大小</span><br><span class="line">   <span class="attr">inactive=time</span></span><br><span class="line">      非活动时长</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>、fastcgi_cache zone | off;</span><br><span class="line">   调用指定的缓存空间来缓存数据可用位置: http, server, location</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>、fastcgi_cache_key string;</span><br><span class="line">   定义用作缓存项的key的字符串</span><br><span class="line">例: fastcgi_cache_key $request_rui;</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>、fastcgi_cache_methods GET | HEAD | POST ...;</span><br><span class="line">   为哪些请求方法使用缓存</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>、fastcgi_cache_min_uses number;</span><br><span class="line">   缓存空间中的缓存项在inactive定义的非活动时间内至少要被访问到此处所</span><br><span class="line">     指定的次数方可被认作活动项</span><br><span class="line"></span><br><span class="line"><span class="number">9</span>、fastcgi_keep_conn  on | off;</span><br><span class="line">   收到后端服务器响应后，fastcgi服务器是否关闭连接，建议启用长连接</span><br><span class="line"></span><br><span class="line"><span class="number">10</span>、fastcgi_cache_valid [code ...] time;</span><br><span class="line">   不同的响应码各自的缓存时长</span><br><span class="line"></span><br><span class="line">例:</span><br><span class="line">http &#123;</span><br><span class="line">   fastcgi_cache_path /var/cache/nginx/fcgi_cache <span class="attr">levels=1:2:1</span> </span><br><span class="line">     <span class="attr">keys_zone=fcgicache:20m</span> <span class="attr">inactive=120s;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">定义在http字段当中</span><br><span class="line">   server &#123;</span><br><span class="line">      location ~* \.php$ &#123;</span><br><span class="line">         ...</span><br><span class="line">         fastcgi_cache fcgicache;</span><br><span class="line">         fastcgi_cache_key $request_uri;</span><br><span class="line">         fastcgi_cache_valid <span class="number">200</span> <span class="number">302</span> <span class="number">10</span>m;</span><br><span class="line">         fastcgi_cache_valid <span class="number">301</span> <span class="number">1</span>h;</span><br><span class="line">         fastcgi_cache_valid any <span class="number">1</span>m;</span><br><span class="line">         ...</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="ngx-http-upstream-module"><a href="#ngx-http-upstream-module" class="headerlink" title="ngx_http_upstream_module"></a>ngx_http_upstream_module</h1><p>用于将多个服务器定义成服务器组，而由proxy_pass，fastcgi_pass等指令进行引用</p>
<h2 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">upstream name &#123;</span><br><span class="line">   <span class="built_in">..</span>.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">定义后端服务器组，会引入一个新的上下文</span><br><span class="line">默认调度算法是wrr Context: http</span><br><span class="line">   upstream httpdsrvs &#123;</span><br><span class="line">     <span class="built_in"> server </span><span class="built_in">..</span>.</span><br><span class="line">     <span class="built_in"> server </span><span class="built_in">..</span>.</span><br><span class="line">      <span class="built_in">..</span>.</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="server-1"><a href="#server-1" class="headerlink" title="server"></a>server</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">server address [parameters];</span><br><span class="line">在upstream上下文中server成员，以及相关的参数，Context: upstream address的表示格式</span><br><span class="line">   unix:/PATH/TO/SOME_SOCK_FILE IP[:PORT]</span><br><span class="line">   HOSTNAME[:PORT] parameters</span><br><span class="line">   weight=number  <span class="meta"># 权重，默认为1</span></span><br><span class="line">   max_conns  <span class="meta"># 连接后端报务器最大并发活动连接数，1.11.5后支持</span></span><br><span class="line">   max_fails=number  <span class="meta"># 失败尝试最大次数，超出指定次数时，server将被标记为不可用</span></span><br><span class="line">   <span class="meta"># 默认为1</span></span><br><span class="line">   fail_timeout=<span class="built_in">time</span>  <span class="meta"># 后端服务器标记为不可用状态的连接超时时长，默认10s</span></span><br><span class="line">   backup  <span class="meta"># 将服务器标记为"备用"，即所有服务器均不可用时才启用</span></span><br><span class="line">   <span class="meta"># server 127.0.0.1:backup; 所指定的服务器都不能使用的话，使用这个</span></span><br><span class="line">   down 标记为<span class="string">"不可用"</span>，配合ip_hash使用，实现灰度发布</span><br><span class="line">   <span class="meta"># 标识为down，把新的请求不往这里调度，但是旧的请求还是保留的</span></span><br><span class="line"></span><br><span class="line">ip_hash</span><br><span class="line">   源地址hash调度方法 </span><br><span class="line"></span><br><span class="line">least_conn</span><br><span class="line">   最少连接调度算法，当server拥有不同的权重时其为wlc，</span><br><span class="line">     当所有后端主机连接数相同时，则使用wrr，适用于长连接</span><br><span class="line"></span><br><span class="line">hash <span class="built_in">key</span> [consistent]</span><br><span class="line">   基于指定的<span class="built_in">key</span>的hash表来实现对请求的调度，此处的<span class="built_in">key</span>可以直接文本、变量或二者组合</span><br><span class="line">   作用: 将请求分类，同一类请求将发往同一个upstream server，使用consistent参数，</span><br><span class="line">     将使用ketama一致性hash算法，适用于后端是Cache服务器（如varnish）时使用</span><br><span class="line">   hash $request_uri consistent;</span><br><span class="line">   <span class="meta"># 基于请求的uri，所请求的资源（使用了consistent算法）</span></span><br><span class="line">   hash $remote_addr;</span><br><span class="line">   <span class="meta"># 基于请求的ip地址</span></span><br><span class="line"></span><br><span class="line">keepalive 连接数N;</span><br><span class="line">   为每个worker进程保留的空闲的长连接数量,可节约nginx端口，并减少连接管理的消耗</span><br><span class="line"></span><br><span class="line">health_check [parameters];</span><br><span class="line">   健康状态检测机制，只能用于location上下文</span><br><span class="line">   常用参数:</span><br><span class="line">      interval=<span class="built_in">time</span>  <span class="meta"># 检测的频率，默认为5秒</span></span><br><span class="line">      fails=number  <span class="meta"># 判定服务器不可用的失败检测次数，默认为1次</span></span><br><span class="line">      passes=number  <span class="meta"># 判定服务器可用的失败检测次数，默认为1次</span></span><br><span class="line">      uri=uri  <span class="meta"># 做健康状态检测测试的目标uri，默认为/</span></span><br><span class="line">      match=NAME  <span class="meta"># 健康状态检测的结果评估调用此处指定的match配置块 </span></span><br><span class="line"><span class="meta"># 仅对nginx plus有效</span></span><br><span class="line"></span><br><span class="line">match name &#123; ... &#125;</span><br><span class="line">   对backend server做健康状态检测时，定义其结果判断机制 --&gt; 只能用于http上下文 </span><br><span class="line">   常用的参数:</span><br><span class="line">      status  <span class="built_in">code</span>[  <span class="built_in">code</span> ...]:  <span class="meta"># 期望的响应状态码</span></span><br><span class="line">      <span class="built_in">header</span>  <span class="built_in">HEADER</span>[operator  value]</span><br><span class="line">      <span class="meta"># 期望存在响应首部，也可对期望的响应首部的值基于比较操作符和值进行比较</span></span><br><span class="line">      body</span><br><span class="line">      <span class="meta"># 期望响应报文的主体部分应该有的内容</span></span><br><span class="line"><span class="meta"># 仅对nginx plus有效</span></span><br><span class="line"></span><br><span class="line">例:</span><br><span class="line">http:</span><br><span class="line">   upstream xdgsrvs &#123;</span><br><span class="line">      server <span class="number">172.18</span><span class="number">.48</span><span class="number">.100</span>:<span class="number">80</span> weight <span class="number">2</span>;</span><br><span class="line">      server <span class="number">172.18</span><span class="number">.48</span><span class="number">.200</span>:<span class="number">80</span> weight <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">server:</span><br><span class="line">   location / &#123;</span><br><span class="line">      proxy_pass http:<span class="comment">//xdgsrvs;</span></span><br><span class="line">      <span class="meta"># 前面的配置信息跟之前的一样，http这个必须要写，不然无法调度</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="ngx-stream-core-module"><a href="#ngx-stream-core-module" class="headerlink" title="ngx_stream_core_module"></a>ngx_stream_core_module</h1><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">模拟反代基于tcp或udp的服务连接，即工作于传输层的反代或调度器</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、stream &#123; ... &#125;</span><br><span class="line">   # 定义stream相关的服务，Context: main</span><br><span class="line">   stream &#123;</span><br><span class="line">      upstream telnetsrvs &#123;</span><br><span class="line">         server <span class="number">192.168.22.2:23</span>;</span><br><span class="line">         server <span class="number">192.168.22.3:23</span>;</span><br><span class="line">         least_conn;</span><br><span class="line">      &#125;</span><br><span class="line">   server &#123;</span><br><span class="line">      listen <span class="number">10.1.0.6:23</span>;</span><br><span class="line">      # 当访问<span class="number">10.1.0.6:23</span>的时候，跳转到telnetsrvs服务上</span><br><span class="line">      proxy_pass telnetsrvs;</span><br><span class="line">      # 在http://telnetsrvs前面的http可以不用写，也可以调度</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、listen listen address:port <span class="string">[ssl]</span> <span class="string">[udp]</span> <span class="string">[proxy_protocol]</span> </span><br><span class="line">  <span class="string">[backlog=number]</span> <span class="string">[bind]</span> <span class="string">[ipv6only=on|off]</span> <span class="string">[reuseport]</span> </span><br><span class="line">  <span class="string">[so_keepalive=on|off|[keepidle]</span>:<span class="string">[keepintvl]</span>:<span class="string">[keepcnt]</span>];</span><br><span class="line"></span><br><span class="line">可实现代理基于TCP，UDP (<span class="number">1</span>.<span class="number">9</span>.<span class="number">13</span>)，UNIX-domain sockets的数据流</span><br><span class="line">   proxy_pass address;  # 指定后端服务器地址</span><br><span class="line">   proxy_timeout timeout;  # 无数据传输时，保持连接状态的超时时长，默认为10m</span><br><span class="line">   proxy_connect_timeout time;  # 设置nginx与被代理的服务器尝试建立连接的超时时长</span><br><span class="line">   # 默认为60s</span><br><span class="line">例:</span><br><span class="line">   stream &#123;</span><br><span class="line">      upstream telnetsrvs &#123;</span><br><span class="line">         server <span class="number">192.168.10.130:23</span>;</span><br><span class="line">         server <span class="number">192.168.10.131:23</span>;</span><br><span class="line">         hash $remote_addr consistent;</span><br><span class="line">      &#125;</span><br><span class="line">      server &#123;</span><br><span class="line">         listen <span class="number">172.16.100.10:2323</span>;</span><br><span class="line">         proxy_pass telnetsrvs;</span><br><span class="line">         proxy_timeout 60s;</span><br><span class="line">         proxy_connect_timeout 10s;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Nginx/" rel="tag"># Nginx</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/03/linux/服务/Nginx/Nginx基础理论/" rel="next" title="Nginx基础理论">
                <i class="fa fa-chevron-left"></i> Nginx基础理论
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/03/linux/服务/Nginx/Nginx编译安装/" rel="prev" title="Nginx编译安装">
                Nginx编译安装 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="XDG" />
          <p class="site-author-name" itemprop="name">XDG</p>
           
              <p class="site-description motion-element" itemprop="description">Personal Blog</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">97</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">74</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/sun-monkeys/xdg/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/xddggg" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-core-module"><span class="nav-number">1.</span> <span class="nav-text">ngx_http_core_module</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#与套接字相关的配置"><span class="nav-number">1.1.</span> <span class="nav-text">与套接字相关的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#server"><span class="nav-number">1.1.1.</span> <span class="nav-text">server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#listen"><span class="nav-number">1.1.2.</span> <span class="nav-text">listen</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#server-name"><span class="nav-number">1.1.3.</span> <span class="nav-text">server_name</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tcp-nodelay"><span class="nav-number">1.1.4.</span> <span class="nav-text">tcp_nodelay</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sendfile"><span class="nav-number">1.1.5.</span> <span class="nav-text">sendfile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#server-tokens"><span class="nav-number">1.1.6.</span> <span class="nav-text">server_tokens</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定义路径相关的配置"><span class="nav-number">1.2.</span> <span class="nav-text">定义路径相关的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#root"><span class="nav-number">1.2.1.</span> <span class="nav-text">root</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#location"><span class="nav-number">1.2.2.</span> <span class="nav-text">location</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#alias"><span class="nav-number">1.2.3.</span> <span class="nav-text">alias</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#index"><span class="nav-number">1.2.4.</span> <span class="nav-text">index</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#error-page"><span class="nav-number">1.2.5.</span> <span class="nav-text">error_page</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#try-files"><span class="nav-number">1.2.6.</span> <span class="nav-text">try_files</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定义客户端请求的相关配置"><span class="nav-number">1.3.</span> <span class="nav-text">定义客户端请求的相关配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#keepalive-timeout"><span class="nav-number">1.3.1.</span> <span class="nav-text">keepalive_timeout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keepalive-requests"><span class="nav-number">1.3.2.</span> <span class="nav-text">keepalive_requests</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keepalive-disable"><span class="nav-number">1.3.3.</span> <span class="nav-text">keepalive_disable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#send-timeout"><span class="nav-number">1.3.4.</span> <span class="nav-text">send_timeout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#client-body-buffer-size"><span class="nav-number">1.3.5.</span> <span class="nav-text">client_body_buffer_size</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#client-body-temp-path"><span class="nav-number">1.3.6.</span> <span class="nav-text">client_body_temp_path</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#limit-rate"><span class="nav-number">1.3.7.</span> <span class="nav-text">limit_rate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#limit-except"><span class="nav-number">1.3.8.</span> <span class="nav-text">limit_except</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件操作优化的配置"><span class="nav-number">1.4.</span> <span class="nav-text">文件操作优化的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#aio"><span class="nav-number">1.4.1.</span> <span class="nav-text">aio</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#directio"><span class="nav-number">1.4.2.</span> <span class="nav-text">directio</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#open-file-cache"><span class="nav-number">1.4.3.</span> <span class="nav-text">open_file_cache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#open-file-cache-errors"><span class="nav-number">1.4.4.</span> <span class="nav-text">open_file_cache_errors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#open-file-cache-min-uses"><span class="nav-number">1.4.5.</span> <span class="nav-text">open_file_cache_min_uses</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#open-file-cache-valid"><span class="nav-number">1.4.6.</span> <span class="nav-text">open_file_cache_valid</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-access-module"><span class="nav-number">2.</span> <span class="nav-text">ngx_http_access_module</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实现基于ip的访问控制功能"><span class="nav-number">2.1.</span> <span class="nav-text">实现基于ip的访问控制功能</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-auth-basic-module"><span class="nav-number">3.</span> <span class="nav-text">ngx_http_auth_basic_module</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实现基于用户的访问控制，使用basic机制进行用户认证"><span class="nav-number">3.1.</span> <span class="nav-text">实现基于用户的访问控制，使用basic机制进行用户认证</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-stub-status-module"><span class="nav-number">4.</span> <span class="nav-text">ngx_http_stub_status_module</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#用于输出nginx的基本状态信息"><span class="nav-number">4.1.</span> <span class="nav-text">用于输出nginx的基本状态信息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-log-module"><span class="nav-number">5.</span> <span class="nav-text">ngx_http_log_module</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#指定日志格式记录请求"><span class="nav-number">5.1.</span> <span class="nav-text">指定日志格式记录请求</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-gzip-module"><span class="nav-number">6.</span> <span class="nav-text">ngx_http_gzip_module</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-ssl-module"><span class="nav-number">7.</span> <span class="nav-text">ngx_http_ssl_module</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-rewrite-module"><span class="nav-number">8.</span> <span class="nav-text">ngx_http_rewrite_module</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#rewrite"><span class="nav-number">8.1.</span> <span class="nav-text">rewrite</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#return"><span class="nav-number">8.2.</span> <span class="nav-text">return</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rewrite-log"><span class="nav-number">8.3.</span> <span class="nav-text">rewrite_log</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#set"><span class="nav-number">8.4.</span> <span class="nav-text">set</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#if"><span class="nav-number">8.5.</span> <span class="nav-text">if</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-referer-module"><span class="nav-number">9.</span> <span class="nav-text">ngx_http_referer_module</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-proxy-module"><span class="nav-number">10.</span> <span class="nav-text">ngx_http_proxy_module</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-pass"><span class="nav-number">10.1.</span> <span class="nav-text">proxy_pass</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-set-header"><span class="nav-number">10.2.</span> <span class="nav-text">proxy_set_header</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-cache-path"><span class="nav-number">10.3.</span> <span class="nav-text">proxy_cache_path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-cache"><span class="nav-number">10.4.</span> <span class="nav-text">proxy_cache</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-cache-key"><span class="nav-number">10.5.</span> <span class="nav-text">proxy_cache_key</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-cache-valid"><span class="nav-number">10.6.</span> <span class="nav-text">proxy_cache_valid</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-cache-use-stale"><span class="nav-number">10.7.</span> <span class="nav-text">proxy_cache_use_stale</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-cache-methods"><span class="nav-number">10.8.</span> <span class="nav-text">proxy_cache_methods</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-hide-header"><span class="nav-number">10.9.</span> <span class="nav-text">proxy_hide_header</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-connect-timeout"><span class="nav-number">10.10.</span> <span class="nav-text">proxy_connect_timeout</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-send-timeout"><span class="nav-number">10.11.</span> <span class="nav-text">proxy_send_timeout</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-read-timeout"><span class="nav-number">10.12.</span> <span class="nav-text">proxy_read_timeout</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-headers-module"><span class="nav-number">11.</span> <span class="nav-text">ngx_http_headers_module</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-fastcgi-module"><span class="nav-number">12.</span> <span class="nav-text">ngx_http_fastcgi_module</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-http-upstream-module"><span class="nav-number">13.</span> <span class="nav-text">ngx_http_upstream_module</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#upstream"><span class="nav-number">13.1.</span> <span class="nav-text">upstream</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#server-1"><span class="nav-number">13.2.</span> <span class="nav-text">server</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ngx-stream-core-module"><span class="nav-number">14.</span> <span class="nav-text">ngx_stream_core_module</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XDG</span>
</div>


<div class="powered-by">
   心有猛虎
</div>

<div class="theme-info">
  细嗅蔷薇
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  





  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
